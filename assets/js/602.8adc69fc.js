(window.webpackJsonp=window.webpackJsonp||[]).push([[602],{988:function(a,e,t){"use strict";t.r(e);var s=t(8),r=Object(s.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"replication"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#replication"}},[a._v("#")]),a._v(" Replication")]),a._v(" "),e("WrappedSection",[e("h3",{attrs:{id:"replication-strategy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#replication-strategy"}},[a._v("#")]),a._v(" Replication strategy")]),a._v(" "),e("p",[a._v("immudb includes support for replication by means of a follower approach. A database can be created or configured either to be a primary or a replica of another database.")]),a._v(" "),e("div",{staticClass:"wrapped-picture"},[e("p",[e("img",{attrs:{src:"/immudb/replication-servers.jpg",alt:"replication using grpc clients"}})])]),a._v(" "),e("p",[a._v("During replication, primary databases have a passive role. The grpc endpoint "),e("code",[a._v("ExportTx")]),a._v(" is used by replicas to fetch unseen committed transactions from the primary.")]),a._v(" "),e("p",[a._v("Replicas are read only and any direct write operation will be rejected. Using replicas allow to distribute query loads.")]),a._v(" "),e("div",{staticClass:"wrapped-picture"},[e("p",[e("img",{attrs:{src:"/immudb/replication-comm.jpg",alt:"replicator fetches committed txs via grpc calls and replicate them using in-process method invocations"}})])])]),a._v(" "),e("WrappedSection",[e("h3",{attrs:{id:"replication-and-users"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#replication-and-users"}},[a._v("#")]),a._v(" Replication and users")]),a._v(" "),e("p",[a._v("As shown in the diagram above, the replicator fetches committed transaction from the primary via grpc calls. Internally, the replicator instantiates an immudb client (using the official golang SDK) and fetches unseen committed transactions from the primary. In order to do so, the replicator requires valid user credentials with admin permissions, otherwise the primary will reject any request.")])]),a._v(" "),e("WrappedSection",[e("h3",{attrs:{id:"creating-a-replica"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-replica"}},[a._v("#")]),a._v(" Creating a replica")]),a._v(" "),e("p",[a._v("Creating a replica of an existent database using immuadmin is super easy:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("$ ./immuadmin login immudb\nPassword:\nlogged "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v("\n$ ./immuadmin database create "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --replication-is-replica "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --replication-primary-username"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("immudb "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --replication-primary-password"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("immudb "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --replication-primary-database"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("defaultdb "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    replicadb\ndatabase "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'replicadb'")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("replica: true"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" successfully created\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),e("p",[a._v("Display all database creation flags with:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("$ ./immuadmin "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("help")]),a._v(" database create \n")])])])]),a._v(" "),e("h3",{attrs:{id:"creating-a-second-immudb-instance-to-replicate-systemdb-and-defaultdb-behaves-similarly"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-second-immudb-instance-to-replicate-systemdb-and-defaultdb-behaves-similarly"}},[a._v("#")]),a._v(" Creating a second immudb instance to replicate systemdb and defaultdb behaves similarly")]),a._v(" "),e("p",[a._v("Start immudb with enabled replication:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("$ ./immudb "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --replication-is-replica "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --replication-primary-username"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("immudb "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --replication-primary-password"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("immudb "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --replication-primary-host"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),e("p",[a._v("Display all replication flags:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("$ ./immudb "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--help")]),a._v("\n")])])])])]),a._v(" "),e("WrappedSection",[e("h3",{attrs:{id:"multiple-replicas"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#multiple-replicas"}},[a._v("#")]),a._v(" Multiple replicas")]),a._v(" "),e("p",[a._v("It's possible to create multiple replicas of a database. Each replica works independently of the others.")]),a._v(" "),e("div",{staticClass:"wrapped-picture"},[e("p",[e("img",{attrs:{src:"/immudb/replication-multiple.jpg",alt:"multiple replicas of the same primary database"}})])]),a._v(" "),e("p",[a._v("Given the primary database acts in passive mode, there are no special steps needed in order to create more replicas. Thus, by repeating the same steps to create the first replica it's possible to configure new ones.")])]),a._v(" "),e("WrappedSection",[e("h3",{attrs:{id:"replica-of-a-replica"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#replica-of-a-replica"}},[a._v("#")]),a._v(" Replica of a replica")]),a._v(" "),e("p",[a._v("In case many replicas are needed or the primary database is under heavy load, it's possible to delegate the creation of replicas to an existent replica. This way, the primary database is not affected by the total number of replicas being created.")]),a._v(" "),e("div",{staticClass:"wrapped-picture"},[e("p",[e("img",{attrs:{src:"/immudb/replication-chain.jpg",alt:"a replica indirectly following the primary"}})])])]),a._v(" "),e("WrappedSection",[e("h3",{attrs:{id:"external-replicator"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#external-replicator"}},[a._v("#")]),a._v(" External replicator")]),a._v(" "),e("p",[a._v("By creating a database as a replica but with disabled replication, no replicator is created for the database and an external process could be used to replicate committed transactions from the primary. The grpc endpoint "),e("code",[a._v("ReplicateTx")]),a._v(" may be used to externally replicate a transaction.")])]),a._v(" "),e("WrappedSection",[e("h3",{attrs:{id:"heterogeneous-settings"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#heterogeneous-settings"}},[a._v("#")]),a._v(" Heterogeneous settings")]),a._v(" "),e("p",[a._v("Replication is configured per database. Thus, the same immudb server may hold several primary and replica databases at the same time.")]),a._v(" "),e("div",{staticClass:"wrapped-picture"},[e("img",{attrs:{src:"/immudb/replication-server.jpg",width:"300",alt:"a single immudb server can hold multiple primary and replica databases"}})])]),a._v(" "),e("WrappedSection",[e("h3",{attrs:{id:"replicator-tool"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#replicator-tool"}},[a._v("#")]),a._v(" Replicator tool")]),a._v(" "),e("p",[a._v("You may need to keep a copy of every database on one immudb instance on another, so that when a new database is created\non the main instance, a replicated database is created on the replica.")]),a._v(" "),e("p",[a._v("In that case you can use the "),e("a",{attrs:{href:"https://github.com/codenotary/immudb-tools/tree/main/replicator",target:"_blank",rel:"noopener noreferrer"}},[a._v("replicator tool"),e("OutboundLink")],1),a._v(", part of the\n"),e("a",{attrs:{href:"https://github.com/codenotary/immudb-tools",target:"_blank",rel:"noopener noreferrer"}},[a._v("immudb tools"),e("OutboundLink")],1),a._v(".")]),a._v(" "),e("p",[a._v("This tool connects to two immudb instances, one main instance and a replica. Periodically, scans the list of databases\npresent on the main instance and it compares that with the list of databases present on the replica. If it finds any new\ndatabases that are missing on the replicas, it will recreate it on the replica and it will configure it to start following\nits counterpart on the main.")]),a._v(" "),e("p",[a._v("If necessary (usually it is) it will also create the replication user on the main instance for the new database(s).")]),a._v(" "),e("p",[a._v("Using this tool you won't need to manually configure replicated databases on replica instance(s).")]),a._v(" "),e("p",[a._v("You can have more information about this tool on its "),e("a",{attrs:{href:"https://github.com/codenotary/immudb-tools/tree/main/replicator",target:"_blank",rel:"noopener noreferrer"}},[a._v("README page"),e("OutboundLink")],1),a._v(".")])])],1)}),[],!1,null,null,null);e.default=r.exports}}]);